<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Effort | HNSN Period</title>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

    <style>
        :root {
            --bg-body: #f1f5f9; --bg-card: #ffffff;
            --text-pri: #334155; --text-sec: #64748b;
            --brand: #0284c7; --danger: #ef4444; --success: #10b981; --warn: #f59e0b;
        }
        body { background: var(--bg-body); color: var(--text-pri); font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; padding-top: 45px; overflow-x: hidden; }

        /* Ticker */
        .ticker-wrap { position: fixed; top: 0; left: 0; width: 100%; height: 40px; background: #0f172a; color: #fff; z-index: 2000; display: flex; align-items: center; border-bottom: 3px solid var(--brand); }
        .ticker-move { display: flex; gap: 60px; white-space: nowrap; animation: scroll 60s linear infinite; padding-left: 100%; align-items: center; }
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
        .t-item { font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; gap: 8px; }

        /* Anima√ß√µes */
        @keyframes pulse-red { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .anim-alert { animation: pulse-red 1.5s infinite; color: var(--danger); }
        @keyframes border-flash { 0% { border-left-color: var(--danger); background: rgba(239,68,68,0.05); } 50% { border-left-color: transparent; background: transparent; } 100% { border-left-color: var(--danger); background: rgba(239,68,68,0.05); } }

        /* Layout */
        .main-container { max-width: 1600px; margin: 20px auto; padding: 0 20px; }
        .header-bar { background: var(--bg-card); padding: 15px 25px; border-radius: 10px; border-left: 5px solid var(--brand); margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .brand-title { font-weight: 900; font-size: 1.8rem; color: #0f172a; letter-spacing: -0.5px; }
        .brand-subtitle { color: var(--text-sec); font-size: 0.9rem; font-weight: 600; text-transform: uppercase; }

        /* KPIs */
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
        .kpi-card { background: var(--bg-card); padding: 20px; border-radius: 10px; border: 1px solid #e2e8f0; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .kpi-val { font-size: 2.5rem; font-weight: 800; margin-top: 5px; line-height: 1; }
        .kpi-lbl { font-size: 0.75rem; text-transform: uppercase; color: var(--text-sec); font-weight: 700; }
        .kpi-icon { position: absolute; right: 20px; top: 20px; font-size: 1.8rem; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }

        /* Content */
        .content-grid { display: grid; grid-template-columns: 2.5fr 1fr; gap: 20px; }
        .panel { background: var(--bg-card); border-radius: 10px; border: 1px solid #e2e8f0; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        /* Toolbar */
        .toolbar { padding: 10px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        .custom-select, .date-input { padding: 6px 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 0.85rem; font-weight: 600; color: #334155; }
        .date-group { display: flex; align-items: center; gap: 5px; background: #e2e8f0; padding: 2px 8px; border-radius: 6px; }
        .date-label { font-size: 0.7rem; font-weight: bold; text-transform: uppercase; color: #64748b; }
        .search-box { flex: 1; min-width: 150px; padding: 6px 12px; border: 1px solid #cbd5e1; border-radius: 6px; }

        /* Table */
        .table-container { height: 500px; overflow-y: auto; }
        .custom-table { width: 100%; border-collapse: separate; border-spacing: 0; font-size: 0.85rem; }
        .custom-table th { position: sticky; top: 0; background: #e2e8f0; z-index: 10; padding: 10px 15px; text-align: left; font-weight: 700; color: #475569; border-bottom: 2px solid #cbd5e1; }
        .custom-table td { padding: 10px 15px; border-bottom: 1px solid #f1f5f9; vertical-align: middle; border-left: 6px solid transparent; }
        .custom-table tr:hover { background: #f8fafc; cursor: pointer; }
        
        /* Signalization */
        .row-crit td:first-child { border-left-color: var(--danger); }
        .row-crit { animation: border-flash 2s infinite; }
        .row-open td:first-child { border-left-color: var(--warn); }
        .row-closed td:first-child { border-left-color: var(--success); }

        /* Upload */
        .upload-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f4f6f8; z-index: 3000; display: flex; justify-content: center; align-items: center; }
        .upload-box { background: #fff; padding: 50px; border-radius: 20px; text-align: center; border: 2px dashed #cbd5e1; cursor: pointer; }
        
        /* Modal Print */
        .btn-print { background-color: var(--brand); color: white; width: 100%; font-weight: bold; border: none; padding: 10px; border-radius: 6px; }
    </style>
</head>
<body>

<div class="ticker-wrap"><div class="ticker-move" id="tickerContent"><span class="t-item">‚ö†Ô∏è SISTEMA AGUARDANDO DADOS...</span></div></div>

<div id="uploadScreen" class="upload-overlay">
    <div class="upload-box" onclick="document.getElementById('fileInput').click()">
        <i class="fa-solid fa-file-csv fa-4x mb-3 text-primary"></i>
        <h3>Dashboard Effort</h3>
        <p class="text-muted">Importar Relat√≥rio (.xlsx / .csv)</p>
        <input type="file" id="fileInput" hidden accept=".csv, .xlsx, .xls" onchange="processFile(this.files)">
        <div id="loader" class="mt-3 text-primary fw-bold" style="display:none">Processando...</div>
    </div>
</div>

<div class="main-container" id="dashboard" style="display:none;">
    <div class="header-bar">
        <div>
            <div class="brand-title">DASHBOARD <span style="color:var(--brand)">EFFORT</span></div>
            <div class="brand-subtitle"><i class="fa-solid fa-screwdriver-wrench"></i> Manuten√ß√£o HNSN</div>
        </div>
        <div>
            <button class="btn btn-primary fw-bold btn-sm" onclick="document.getElementById('fileInput').click()">Nova Importa√ß√£o</button>
        </div>
    </div>

    <div class="kpi-grid">
        <div class="kpi-card" style="border-left: 4px solid var(--danger);">
            <div class="kpi-icon anim-alert" style="background:rgba(239,68,68,0.1); border-radius:50%; color:var(--danger)"><i class="fa-solid fa-bell"></i></div>
            <div class="kpi-lbl">Cr√≠ticos Abertos</div>
            <div class="kpi-val text-danger" id="kpiCrit">0</div>
        </div>
        <div class="kpi-card" style="border-left: 4px solid var(--brand);">
            <div class="kpi-icon text-primary"><i class="fa-solid fa-clock"></i></div>
            <div class="kpi-lbl">Total Pendente</div>
            <div class="kpi-val text-primary" id="kpiOpen">0</div>
        </div>
        <div class="kpi-card" style="border-left: 4px solid var(--warn);">
            <div class="kpi-icon text-warning"><i class="fa-solid fa-hourglass-half"></i></div>
            <div class="kpi-lbl">Tempo M√©dio (TMA)</div>
            <div class="kpi-val text-warning" id="kpiTma">0h</div>
        </div>
        <div class="kpi-card" style="border-left: 4px solid var(--success);">
            <div class="kpi-icon text-success"><i class="fa-solid fa-check-circle"></i></div>
            <div class="kpi-lbl">Conclu√≠dos</div>
            <div class="kpi-val text-success" id="kpiClosed">0</div>
        </div>
    </div>

    <div class="content-grid">
        <div class="panel">
            <div class="toolbar">
                <div style="flex:1" class="d-flex align-items-center gap-2">
                    <h6 class="m-0 fw-bold text-muted"><i class="fa-solid fa-filter me-2"></i>Filtros</h6>
                    <button id="btnClearFilter" class="btn btn-sm btn-warning fw-bold" style="display:none; font-size:0.7rem;" onclick="clearFilter()">Limpar Gr√°fico</button>
                </div>

                <div class="date-group">
                    <span class="date-label">In√≠cio:</span>
                    <input type="date" id="fDateStart" class="date-input" onchange="updateDash()">
                </div>
                <div class="date-group">
                    <span class="date-label">Fim:</span>
                    <input type="date" id="fDateEnd" class="date-input" onchange="updateDash()">
                </div>

                <select id="fStatus" class="custom-select" onchange="renderTable()"><option value="Aberto">Status: Abertos</option><option value="Fechado">Status: Fechados</option><option value="TODOS">Status: Todos</option></select>
                <select id="fOficina" class="custom-select" onchange="renderTable()"><option value="TODAS">Todas Oficinas</option></select>
                <input type="text" id="fSearch" class="search-box" placeholder="üîé Buscar..." onkeyup="renderTable()">
            </div>
            
            <div class="table-container">
                <table class="custom-table">
                    <thead><tr><th width="30"></th><th>OS</th><th>Oficina</th><th>Setor</th><th>Descri√ß√£o</th><th>Data</th></tr></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
            <div class="p-2 text-end small text-muted border-top" id="tbCount">0 Registros</div>
        </div>

        <div class="d-flex flex-column gap-3">
            <div class="panel p-3">
                <h6 class="small fw-bold text-muted mb-3">DEMANDA (ABERTOS)</h6>
                <div id="chartOficina"></div>
            </div>
            <div class="panel p-3" style="flex:1">
                <h6 class="small fw-bold text-muted mb-3">T√âCNICOS (RESOLVIDOS)</h6>
                <div id="chartTecnico"></div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalDet" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header py-2">
                <h5 class="modal-title fw-bold" id="mTitle">OS #</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row g-2 small">
                    <div class="col-6"><strong>Oficina:</strong> <span id="mOficina">-</span></div>
                    <div class="col-6"><strong>Setor:</strong> <span id="mSetor" class="text-primary fw-bold">-</span></div>
                    <div class="col-12 p-3 bg-light border rounded mt-2 mb-2" id="mDesc" style="font-family:monospace">-</div>
                    <div class="col-6"><strong>Data:</strong> <span id="mData">-</span></div>
                    <div class="col-6"><strong>Req:</strong> <span id="mReq">-</span></div>
                    <div class="col-12 pt-2 border-top"><strong>T√©cnico:</strong> <span id="mTec" class="text-success fw-bold">-</span></div>
                </div>
            </div>
            <div class="modal-footer bg-light p-2">
                <button type="button" class="btn-print" onclick="imprimirOS()"><i class="fa-solid fa-print me-2"></i> IMPRIMIR O.S.</button>
            </div>
        </div>
    </div>
</div>

<script>
    let rawData=[], currentOS=null, chartFilter=null, fileDateLabel="HOJE";

    function processFile(files) {
        if(!files.length) return;
        const n=files[0].name, m=n.match(/(\d{8})_(\d{6})/);
        fileDateLabel = m ? `${m[1].substr(0,2)}/${m[1].substr(2,2)}/${m[1].substr(4,4)}` : new Date().toLocaleDateString();
        document.getElementById('loader').style.display='block';
        const r=new FileReader();
        r.onload=e=>{
            const w=XLSX.read(e.target.result,{type:'array',cellDates:true});
            const j=XLSX.utils.sheet_to_json(w.Sheets[w.SheetNames[0]],{defval:""});
            parseData(j);
        };
        r.readAsArrayBuffer(files[0]);
    }

    function parseDate(v) {
        if (!v) return null;
        if (v instanceof Date) return v;
        if (typeof v === 'string') {
            const p = v.split(/[\/\s:]/);
            if (p.length >= 3) return new Date(p[2], p[1]-1, p[0], p[3]||0, p[4]||0);
        }
        return null;
    }

    function parseData(json) {
        const k = { os:"OS", st:"Situa√ß√£o da OS", prio:"Prioridade", ofi:"Oficina", set:"Setor", desc:"Observa√ß√£o da Requisi√ß√£o", tec:"T√©cnico Resolvedor", resp:"Respons√°vel", dtOpen:"Abertura", dtClose:"Fechamento Real", req:"Requisitante", reqNum:"N¬∫ Requisi√ß√£o" };

        rawData = json.map(r => {
            let dOpen = parseDate(r[k.dtOpen]);
            let dClose = parseDate(r[k.dtClose]) || parseDate(r["Fechamento"]) || parseDate(r["Data de Solu√ß√£o"]);
            let st = "Aberto", sRaw = (r[k.st]||"").toUpperCase();
            if(sRaw.includes("FECH")||sRaw.includes("CONC")||sRaw.includes("SOLUCI")) st = "Fechado";
            else if(sRaw.includes("CANCEL")) st = "Cancelado";
            
            let crit = (r[k.prio]||"").toUpperCase().includes("ALTA") || (r[k.prio]||"").toUpperCase().includes("URG");
            let dur = (st==="Fechado" && dOpen && dClose) ? (dClose - dOpen) : null;
            if(dur<0) dur=null;

            return {
                os: String(r[k.os]), st, prio: r[k.prio], ofi: (r[k.ofi]||"GERAL").toUpperCase(),
                set: r[k.set]||"", desc: r[k.desc]||"Sem descri√ß√£o",
                tec: st==="Fechado"?r[k.tec]:r[k.resp],
                req: r[k.req]||"", reqNum: r[k.reqNum]||"", dOpen, dur,
                dStr: dOpen?dOpen.toLocaleDateString('pt-BR'):"-", crit
            };
        });
        initUI();
    }

    function initUI() {
        document.getElementById('uploadScreen').style.display='none';
        document.getElementById('dashboard').style.display='block';
        
        const ofis = [...new Set(rawData.map(d=>d.ofi))].sort();
        const sel = document.getElementById('fOficina');
        sel.innerHTML = `<option value="TODAS">Oficinas: Todas</option>`;
        ofis.forEach(o => sel.innerHTML += `<option value="${o}">${o}</option>`);
        
        updateDash();
    }

    // --- FILTRAGEM CENTRAL (Incluindo Datas) ---
    function getFilteredData() {
        let d = rawData;
        
        // 1. Filtro de Data
        const dStart = document.getElementById('fDateStart').value;
        const dEnd = document.getElementById('fDateEnd').value;
        if(dStart) {
            const dtS = new Date(dStart); dtS.setHours(0,0,0,0);
            d = d.filter(x => x.dOpen && x.dOpen >= dtS);
        }
        if(dEnd) {
            const dtE = new Date(dEnd); dtE.setHours(23,59,59,999);
            d = d.filter(x => x.dOpen && x.dOpen <= dtE);
        }

        // 2. Filtro de Gr√°fico
        if(chartFilter) {
            if(chartFilter.t==='ofi') d = d.filter(x => x.ofi === chartFilter.v);
            if(chartFilter.t==='tec') d = d.filter(x => x.tec && x.tec.includes(chartFilter.v));
        }
        return d;
    }

    function updateDash() {
        const d = getFilteredData();
        const ab = d.filter(x=>x.st==="Aberto"), fe = d.filter(x=>x.st==="Fechado"), cr = ab.filter(x=>x.crit);
        
        document.getElementById('kpiOpen').innerText = ab.length;
        document.getElementById('kpiClosed').innerText = fe.length;
        document.getElementById('kpiCrit').innerText = cr.length;

        let tot=0, c=0; fe.forEach(x=>{if(x.dur>0){tot+=x.dur;c++}});
        const h=c>0?Math.floor((tot/c)/3600000):0;
        document.getElementById('kpiTma').innerText=h>24?`${Math.floor(h/24)}d`:h+"h";

        let tk = `<span class="t-item ms-5"><i class="fa-solid fa-database"></i> DATA BASE: ${fileDateLabel}</span>`;
        if(cr.length) tk += `<span class="t-item text-danger ms-5">üîî ALERTA: ${cr.length} CR√çTICOS</span>`;
        tk += `<span class="t-item text-success ms-5">üèÜ RESOLVIDOS PER√çODO: ${fe.length}</span>`;
        document.getElementById('tickerContent').innerHTML = tk+tk;

        renderTable();
        renderCharts(ab, fe);
    }

    function renderTable() {
        let d = getFilteredData(); // Pega dados j√° filtrados por data e gr√°fico
        const st = document.getElementById('fStatus').value;
        const ofi = document.getElementById('fOficina').value;
        const txt = document.getElementById('fSearch').value.toLowerCase();

        // Filtros da Toolbar da Tabela
        d = d.filter(x => {
            if(st!=="TODOS" && x.st!==st) return false;
            if(ofi!=="TODAS" && x.ofi!==ofi) return false;
            if(txt && !JSON.stringify(x).toLowerCase().includes(txt)) return false;
            return true;
        });

        // Ordena√ß√£o fixa para facilitar (Criticos > Recentes)
        d.sort((a,b) => {
            if (b.crit !== a.crit) return b.crit - a.crit;
            return (b.dOpen||0) - (a.dOpen||0);
        });

        const tb = document.getElementById('tableBody'); tb.innerHTML = "";
        d.slice(0,100).forEach(x => {
            let cls = "row-open"; let icon = `<i class="fa-solid fa-clock text-warning"></i>`;
            if(x.st==="Fechado") { cls = "row-closed"; icon = `<i class="fa-solid fa-check text-success"></i>`; }
            if(x.crit && x.st==="Aberto") { cls = "row-crit"; icon = `<i class="fa-solid fa-bell fa-shake text-danger"></i>`; }

            tb.innerHTML += `<tr onclick="openDet('${x.os}')" class="${cls}"><td>${icon}</td><td class="fw-bold">#${x.os}</td><td>${x.ofi}</td><td>${x.set}</td><td class="text-truncate" style="max-width:200px">${x.desc}</td><td>${x.dStr}</td></tr>`;
        });
        document.getElementById('tbCount').innerText = `${d.length} Registros`;
    }

    function openDet(id) {
        currentOS = rawData.find(x => x.os === id);
        if(!currentOS) return;
        document.getElementById('mTitle').innerText = `OS #${currentOS.os}`;
        document.getElementById('mOficina').innerText = currentOS.ofi;
        document.getElementById('mSetor').innerText = currentOS.set;
        document.getElementById('mDesc').innerText = currentOS.desc;
        document.getElementById('mData').innerText = currentOS.dStr;
        document.getElementById('mReq').innerText = currentOS.req;
        document.getElementById('mTec').innerText = currentOS.tec || "-";
        new bootstrap.Modal(document.getElementById('modalDet')).show();
    }

    function renderCharts(ab, fe) {
        // Recalcular com dados filtrados
        const c1={}; ab.forEach(x=>c1[x.ofi]=(c1[x.ofi]||0)+1);
        const s1=Object.entries(c1).sort((a,b)=>b[1]-a[1]);
        
        new ApexCharts(document.querySelector("#chartOficina"), {
            series:[{data:s1.map(x=>x[1])}],
            chart:{type:'bar',height:200,toolbar:{show:false},events:{dataPointSelection:(e,c,cfg)=>{ 
                const val = cfg.w.config.xaxis.categories[cfg.dataPointIndex];
                document.getElementById('fOficina').value = val;
                document.getElementById('fStatus').value = 'Aberto';
                renderTable(); // Filtro da toolbar
            }}}, colors:['#0284c7'], xaxis:{categories:s1.map(x=>x[0]),labels:{style:{fontSize:'9px'}}}, plotOptions:{bar:{horizontal:true, borderRadius:4}}
        }).render();

        const c2={}; fe.forEach(x=>{if(x.tec){let n=x.tec.split(' ')[0]; c2[n]=(c2[n]||0)+1}});
        const s2=Object.entries(c2).sort((a,b)=>b[1]-a[1]).slice(0,5);
        
        new ApexCharts(document.querySelector("#chartTecnico"), {
            series:[{data:s2.map(x=>x[1])}],
            chart:{type:'bar',height:200,toolbar:{show:false},events:{dataPointSelection:(e,c,cfg)=>{ 
                const val = cfg.w.config.xaxis.categories[cfg.dataPointIndex];
                applyFil('tec', val);
            }}}, colors:['#16a34a'], xaxis:{categories:s2.map(x=>x[0]),labels:{style:{fontSize:'9px'}}}, plotOptions:{bar:{horizontal:false, borderRadius:4}}
        }).render();
    }

    function applyFil(t,v) {
        chartFilter={t,v};
        document.getElementById('btnClearFilter').style.display='block';
        document.getElementById('fStatus').value = (t==='tec') ? 'Fechado' : 'Aberto';
        updateDash();
    }
    function clearFilter() {
        chartFilter=null;
        document.getElementById('btnClearFilter').style.display='none';
        document.getElementById('fStatus').value = 'Aberto';
        updateDash();
    }

    function imprimirOS() {
        if(!currentOS) return;
        const d = currentOS;
        const now = new Date().toLocaleString('pt-BR');
        
        const win = window.open('', '_blank');
        win.document.write(`
            <html>
            <head>
                <title>OS #${d.os}</title>
                <style>
                    @media print { @page { size: A4; margin: 5mm; } body { -webkit-print-color-adjust: exact; } }
                    body { font-family: Arial, sans-serif; font-size: 10px; margin: 0; padding: 10px; color: #000; }
                    .header { display: flex; border-bottom: 2px solid #000; padding-bottom: 5px; margin-bottom: 10px; align-items: center; }
                    .logo { font-size: 20px; font-weight: bold; width: 15%; color: #444; }
                    .title { width: 70%; text-align: center; font-size: 16px; font-weight: bold; padding-top: 5px; }
                    .meta { width: 15%; text-align: right; font-size: 9px; line-height: 1.3; }
                    .row { display: flex; width: 100%; margin-bottom: 2px; }
                    .field-box { margin-right: 5px; border-bottom: 1px dotted #999; padding-bottom: 1px; }
                    .lbl { font-weight: bold; font-size: 9px; }
                    .section-box { border: 1px solid #000; margin-top: 10px; padding: 5px; min-height: 30px; }
                    table { width: 100%; border-collapse: collapse; margin-top: 5px; }
                    th, td { border: 1px solid #000; padding: 3px; text-align: left; font-size: 9px; }
                    th { background: #f0f0f0; text-align: center; font-weight: bold; }
                    .empty-row { height: 25px; }
                    .signatures { display: flex; justify-content: space-around; margin-top: 40px; }
                    .sig { width: 40%; border-top: 1px solid #000; text-align: center; padding-top: 5px; font-size: 9px; }
                </style>
            </head>
            <body>
                <div class="header">
                    <div class="logo">hnsn</div>
                    <div class="title">ORDEM DE SERVI√áO</div>
                    <div class="meta">${now}<br>N¬∫ OS: ${d.os}<br>${d.st}</div>
                </div>
                <div class="row">
                    <div style="width: 50%;">
                        <div class="field-box"><span class="lbl">Tipo da OS:</span> CORRETIVA N√ÉO PLANEJADA</div>
                        <div class="field-box"><span class="lbl">Setor:</span> ${d.set}</div>
                        <div class="field-box"><span class="lbl">Respons√°vel:</span> ${d.tec !== 'N√£o informado' ? d.tec : ''}</div>
                        <div class="field-box"><span class="lbl">Requisitante:</span> ${d.req}</div>
                    </div>
                    <div style="width: 50%;">
                        <div class="field-box"><span class="lbl">Ramal:</span> </div>
                        <div class="field-box"><span class="lbl">Oficina:</span> ${d.ofi}</div>
                        <div class="field-box"><span class="lbl">Aberta em:</span> ${d.dStr}</div>
                        <div class="field-box"><span class="lbl">Prioridade:</span> ${d.prio}</div>
                        <div class="field-box"><span class="lbl">N¬∫ Chamado:</span> ${d.reqNum}</div>
                    </div>
                </div>
                <div class="section-box" style="min-height: 40px;">
                    <span class="lbl">RECLAMA√á√ÉO:</span> <br>${d.desc}
                </div>
                <div style="display: flex; margin-top: 10px; border: 1px solid #000;">
                    <div style="width: 50%; border-right: 1px solid #000; padding: 5px; height: 50px;"><span class="lbl">Ocorr√™ncia/Defeito:</span></div>
                    <div style="width: 50%; padding: 5px; height: 50px;"><span class="lbl">Causa:</span></div>
                </div>
                <table>
                    <thead><tr><th width="30%">T√©cnico (USO EPI/EPC)</th><th width="40%">Servi√ßo/Solu√ß√£o</th><th width="15%">In√≠cio</th><th width="15%">T√©rmino</th></tr></thead>
                    <tbody><tr class="empty-row"><td></td><td></td><td></td><td></td></tr><tr class="empty-row"><td></td><td></td><td></td><td></td></tr></tbody>
                </table>
                <table>
                    <thead><tr><th width="70%">Descri√ß√£o do Material</th><th width="15%">Data</th><th width="15%">Quantidade</th></tr></thead>
                    <tbody><tr class="empty-row"><td></td><td></td><td></td></tr><tr class="empty-row"><td></td><td></td><td></td></tr></tbody>
                </table>
                <div class="section-box" style="height: 30px;"><span class="lbl">Pend√™ncia:</span></div>
                <div class="section-box" style="height: 30px;"><span class="lbl">Observa√ß√µes:</span></div>
                <div class="signatures">
                    <div class="sig">Nome:_________________________<br><strong>T√âCNICO RESPONS√ÅVEL</strong><br>Data: ___/___/_____</div>
                    <div class="sig">Nome:_________________________<br><strong>VISTO DO SETOR</strong><br>Data: ___/___/_____</div>
                </div>
                <div style="font-size: 8px; margin-top: 20px; color: #666;">Legenda: CO-Cancelamento, CT-Certificado, FT-Frota, MO-M√£o de Obra...</div>
            </body>
            </html>
        `);
        win.document.close();
        win.print();
    }
</script>
</body>
</html>